<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="adminMapper">

	<!-- Product -->
	<resultMap type="product" id="productResult">
		<result column="PRODUCT_NO" property="productNo"/>
		<result column="CATEGORY_NAME" property="category"/>
		<result column="TYPE_NAME" property="type"/>
		<result column="BRAND_NAME" property="brand"/>
		<result column="MODEL_NAME" property="model"/>
		<result column="PRODUCT_COLOR" property="color"/>
		<result column="PRODUCT_NAME" property="name"/>
		<result column="PRODUCT_CONTENT" property="content"/>
		<result column="PRODUCT_PRICE" property="price"/>
		<result column="PRODUCT_QUANTITY" property="quantity"/>
		<result column="STATUS" property="status"/>
		<result column="RATING" property="rating"/>
		<result column="COUNT" property="count"/>
		<result column="CHANGE_NAME" property="changeName"/>
		<result column="FILE_PATH" property="filePath"/>
	</resultMap>
	<!-- 제품 정보 입력 -->
	<insert id="addToProduct" parameterType="product">
		INSERT INTO PRODUCT(
		    PRODUCT_NO ,
		    REF_CATEGORY_NO ,
		    REF_TYPE_NO ,
		    REF_MODEL_NO ,
		    PRODUCT_COLOR ,
		    PRODUCT_NAME ,
		    PRODUCT_CONTENT ,
		    PRODUCT_PRICE ,
		    PRODUCT_QUANTITY 
		)
		VALUES(
		    SEQ_PRODUCT.NEXTVAL,
		    #{category},
		    #{type},
		    #{model},
		    #{color},
		    #{name},
		    #{content},
		    #{price},
		    #{quantity}
		)
	</insert>
	<!-- 제품 이미지 추가 -->
	<insert id="addToProductImage" parameterType="list">
		INSERT INTO PRODUCT_ATTACHMENT(
			PRODUCT_ATTACHMENT_NO ,
			REF_PRODUCT_NO ,
			PRODUCT_ATTACHMENT_ORIGIN_NAME ,
			PRODUCT_ATTACHMENT_CHANGE_NAME ,
			PRODUCT_ATTACHMENT_FILE_PATH)
		VALUES 
		<foreach collection="list" item="productAttachment" open="(" close=")" index="index" separator=",">
		    SEQ_PRODUCT_ATTACHMENT.NEXTVAL,
			SEQ_PRODUCT.CURRVAL,
			#{originName},
			#{changeName},
			#{filePath}
		</foreach>
	</insert>
	<!-- 제품 정보 변경 -->
	<update id="changeToProduct" parameterType="product">
		UPDATE PRODUCT
		SET 
		<trim prefixOverrides=",">
			<if test="category != null">
				,REF_CATEGORY_NO = #{category}
			</if>
			<if test="type != null">
				,REF_TYPE_NO = #{type}
			</if>
			<if test="model != null">
				,REF_MODEL_NO = #{model}
			</if>
			<if test="color != null">
				,PRODUCT_COLOR = #{color}
			</if>
			<if test="name != null">
				,PRODUCT_NAME = #{name}
			</if>
			<if test="content != null">
				,PRODUCT_CONTENT = #{content}
			</if>
			<if test="price != 0">
				,PRODUCT_PRICE = #{price}
			</if>
		</trim>
		WHERE PRODUCT_NO LIKE #{productNo}
	</update>
	<!-- 제품 이미지 변경 -->
	<update id="changeToProductImage" parameterType="list">
		<foreach collection="list" item="productAttachment">
			UPDATE PRODUCT_ATTACHMENT
			SET PRODUCT_ATTACHMENT_ORIGIN_NAME = #{originName}
			, PRODUCT_ATTACHMENT_FILE_PATH = #{filePath}
			WHERE REF_PRODUCT_NO LIKE #{productNo}
			AND PRODUCT_ATTACHMENT_NO LIKE #{attachmentNo}
		</foreach>
	</update>
	<!-- 현재 입력한 제품 번호 -->
	<select id="selectSeqProduct" resultType="_int">
		SELECT SEQ_PRODUCT.CURRVAL FROM DUAL
	</select>
	
	
	<update id="removeProduct" parameterType="_int">
		UPDATE PRODUCT
		SET STATUS = 'N'
		WHERE PRODUCT_NO LIKE #{productNo}
	</update>
	
</mapper>
